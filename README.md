# Floppa os 2
На текущем этапе 4 января 2026 **Floppa OS** поддерживает следующий набор возможностей:

### Базовые функции ядра

1. **Инициализация системы**  
   - Загрузка через GRUB (Multiboot‑совместимый загрузчик).
   - Настройка защищённого режима x86‑32.
   - Инициализация страничной памяти (`paging`).
   - Управление кучей (`malloc`/`free`).

2. **Вывод на экран**  
   - Базовый VGA‑драйвер: печать текста в текстовом режиме.
   - Цвета символов (через атрибут байта).

3. **Обработка ввода**  
   - Драйвер клавиатуры (PS/2, прерывания).
   - Чтение нажатий клавиш (упрощённо).

---

### Файловая система (FAT12)

4. **Доступ к носителю**  
   - Чтение секторов диска через BIOS INT 13h.
   - Поддержка флоппи‑дисков (1,44 МБ) или образов `.img`.
5. **Парсинг FAT12**  
   - Разбор BPB (BIOS Parameter Block).
   - Поиск файлов в корневом каталоге по имени.
6. **VFS (виртуальная ФС)**  
   - Абстрактный слой для работы с файлами.
   - Системные вызовы:  
     - `sys_open(path, flags)` — открытие файла.
     - `sys_read(fd, buf, count)` — чтение данных.

---

### Многозадачность (кооперативная)

7. **Управление задачами**  
   - Создание задач через `task_create(func)`.
   - Каждая задача получает собственный стек (4 КБ).
   - Идентификаторы процессов (`pid`).
8. **Планировщик**  
   - Круговой алгоритм (`round‑robin`): задачи выполняются по очереди.
   - Добровольная передача управления через `sys_task_yield()`.
9. **Переключение контекста**  
   - Сохранение/восстановление регистров CPU (ассемблер).
   - Поддержка до 32 задач одновременно.

---

### Системные вызовы (syscalls)

10. **Доступные syscalls**  
    - `SYS_WRITE` — вывод в консоль (через VGA).
    - `SYS_OPEN` / `SYS_READ` — работа с файлами.
    - `SYS_TASK_CREATE` — создание новой задачи.
    - `SYS_TASK_YIELD` — передача управления планировщику.

---

### Утилиты и инструменты

11. **Сборка системы**  
    - `Makefile` для компиляции C/ассемблерных файлов.
    - Линкер‑скрипт `link.ld` (точка входа `start`).
12. **Создание образа ФС**  
    - Скрипт `tools/mkfat12.py` генерирует образ FAT12 (1,44 МБ).
    - Возможность записи файлов в образ (вручную или через доп. скрипты).

---

### Что можно *сделать* в Floppa OS сейчас

- **Запустить ядро** в эмуляторе (QEMU, Bochs) или на реальном железе (с флоппи‑образом).
- **Вывести текст** на экран через `vga_write()` или `sys_write()`.
- **Прочитать файл** с диска:  
  ```c
  int fd = sys_open("hello.txt", 0);
  char buf[100];
  sys_read(fd, buf, 100);
  ```
- **Создать параллельные задачи**:  
  ```c
  task_create(task1);
  task_create(task2);
  // Обе задачи будут выполняться по очереди
  ```
- **Организовать простой GUI‑подобный цикл**:  
  - Одна задача обновляет экран.
  - Другая обрабатывает ввод с клавиатуры.
  - Третья выполняет вычисления.

---

### Чего *пока нет* (планы на развитие)

- **Вытесняющая многозадачность** (нужен таймер и IRQ).
- **Защита памяти** (нет изоляции процессов).
- **Файловые права и директории** (только корневой каталог FAT12).
- **Сетевые возможности**.
- **Драйверы** (кроме VGA и клавиатуры).
- **Пользовательское пространство** (всё работает в режиме ядра).


---

### Пример использования

```c
void task1() {
    while (1) {
        vga_write("Task 1 running\n", 0x0F);
        sys_task_yield();
    }
}

void task2() {
    while (1) {
        vga_write("Task 2 running\n", 0x0C);
        sys_task_yield();
    }
}

void kernel_main() {
    task_init();
    task_create(task1);
    task_create(task2);
    while (1) schedule();
}
```

**Результат**: На экране будут попеременно появляться строки от двух задач.

---
# Команды в консоли
В текущей реализации консоли **Floppa OS** доступны следующие команды:


1. **`help`**  
   - **Назначение**: выводит список всех доступных команд.  
   - **Пример**:  
     ```
     floppa-os $ help
     ```
   - **Вывод**: перечисляет все команды с кратким описанием.

2. **`reboot`**  
   - **Назначение**: перезагружает систему.  
   - **Пример**:  
     ```
     floppa-os $ reboot
     ```
   - **Эффект**: аппаратная перезагрузка через BIOS‑прерывание `int 0x19`.

3. **`ls`**  
   - **Назначение**: показывает файлы в корневом каталоге (упрощённая реализация FAT12).  
   - **Пример**:  
     ```
     floppa-os $ ls
     ```
   - **Вывод**: список файлов (например, `file1.txt`, `kernel.bin`).


4. **`clear`**  
   - **Назначение**: очищает экран консоли.  
   - **Пример**:  
     ```
     floppa-os $ clear
     ```
   - **Эффект**: экран становится пустым, появляется новая строка приглашения.

5. **`echo`**  
   - **Назначение**: выводит на экран указанные аргументы.  
   - **Пример**:  
     ```
     floppa-os $ echo Hello Floppa
     ```
   - **Вывод**:  
     ```
     Hello Floppa
     ```

6. **`cat`**  
   - **Назначение**: отображает содержимое текстового файла.  
   - **Пример**:  
     ```
     floppa-os $ cat hello.txt
     ```
   - **Вывод**: текст из файла `hello.txt` (если файл существует).  
   - **Ошибка**: если файл не найден, выводит сообщение об ошибке.

7. **`pwd`**  
   - **Назначение**: показывает текущий рабочий путь.  
   - **Пример**:  
     ```
     floppa-os $ pwd
     ```
   - **Вывод**: `/` (в текущей реализации ФС нет вложенных директорий).


8. **`date`**  
   - **Назначение**: выводит текущую дату и время (считывает из CMOS‑часов).  
   - **Пример**:  
     ```
     floppa-os $ date
     ```
   - **Вывод**:  
     ```
     2026-01-04 18:33:46
     ```

---

### Краткие значения

| Команда | Назначение |
|--------|-----------|
| `help` | Показать список команд |
| `reboot` | Перезагрузить систему |
| `ls` | Список файлов в корне |
| `clear` | Очистить экран |
| `echo` | Вывести текст |
| `cat` | Показать содержимое файла |
| `pwd` | Текущий путь (`/`) |
| `date` | Текущая дата/время |
| `floppa` | выводит шлёпу |
---
